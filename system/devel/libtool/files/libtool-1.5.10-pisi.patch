diff -ur libtool-1.5.22.orig/ltmain.in libtool-1.5.22/ltmain.in
--- libtool-1.5.22.orig/ltmain.in	2006-06-30 01:38:36.000000000 +0300
+++ libtool-1.5.22/ltmain.in	2006-06-30 01:44:03.000000000 +0300
@@ -5662,9 +5662,48 @@
 		  $echo "$modename: \`$deplib' is not a valid libtool archive" 1>&2
 		  exit $EXIT_FAILURE
 		fi
-		newdependency_libs="$newdependency_libs $libdir/$name"
+		if test "X$EGREP" = X ; then
+			EGREP=egrep
+		fi
+		# We do not want PiSi's install root ($INSTALL_ROOT) present.  Check only for
+		# this if the .la is being installed.
+		if test "$installed" = yes && test "$INSTALL_ROOT"; then
+		  eval mynewdependency_lib=`echo "$libdir/$name" |sed -e "s:$INSTALL_ROOT:/:g" -e 's:/\+:/:g'`
+		else
+		  mynewdependency_lib="$libdir/$name"
+		fi
+		# Do not add duplicates
+		if test "$mynewdependency_lib"; then
+		  my_little_ninja_foo_1=`echo $newdependency_libs |$EGREP -e "$mynewdependency_lib"`
+		  if test -z "$my_little_ninja_foo_1"; then
+		    newdependency_libs="$newdependency_libs $mynewdependency_lib"
+		  fi
+		fi
+		;;
+		  *)
+		if test "$installed" = yes; then
+		  # We do not want PiSi's build root ($WORK_DIR) present.
+		  my_little_ninja_foo_2=`echo $deplib |$EGREP -e "$WORK_DIR"`
+		  # We do not want PiSi's install root ($INSTALL_ROOT) present.
+		  my_little_ninja_foo_3=`echo $deplib |$EGREP -e "$INSTALL_ROOT"`
+		  if test -n "$my_little_ninja_foo_2" && test "$WORK_DIR"; then
+		    mynewdependency_lib=""
+		  elif test -n "$my_little_ninja_foo_3" && test "$INSTALL_DIR"; then
+		    eval mynewdependency_lib=`echo "$deplib" |sed -e "s:$INSTALL_DIR:/:g" -e 's:/\+:/:g'`
+		  else
+		    mynewdependency_lib="$deplib"
+		  fi
+		else
+		  mynewdependency_lib="$deplib"
+		fi
+		# Do not add duplicates
+		if test "$mynewdependency_lib"; then
+		  my_little_ninja_foo_4=`echo $newdependency_libs |$EGREP -e "$mynewdependency_lib"`
+		  if test -z "$my_little_ninja_foo_4"; then
+			newdependency_libs="$newdependency_libs $mynewdependency_lib"
+		  fi
+		fi
 		;;
-	      *) newdependency_libs="$newdependency_libs $deplib" ;;
 	      esac
 	    done
 	    dependency_libs="$newdependency_libs"
@@ -5716,6 +5755,10 @@
 	  case $host,$output,$installed,$module,$dlname in
 	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
 	  esac
+	  # Do not add duplicates
+	  if test "$installed" = yes && test "$INSTALL_DIR"; then
+	    install_libdir=`echo "$install_libdir" |sed -e "s:$INSTALL_DIR:/:g" -e 's:/\+:/:g'`
+	  fi
 	  $echo > $output "\
 # $outputname - a libtool library file
 # Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
