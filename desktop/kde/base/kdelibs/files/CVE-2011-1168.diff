From: Jeff Mitchell <mitchell@kde.org>
Date: Sun, 27 Mar 2011 13:08:44 +0000
Subject: Fix CVE-2011-1168. Credit to Tim Brown of Nth Dimension.
X-Git-Url: http://quickgit.kde.org/?p=kdelibs.git&amp;a=commitdiff&amp;h=da03cc03d46e3d240f0e16c08f29e67518acb7e1
---
Fix CVE-2011-1168. Credit to Tim Brown of Nth Dimension.
---


--- a/khtml/khtml_part.cpp
+++ b/khtml/khtml_part.cpp
@@ -1803,7 +1803,10 @@ void KHTMLPart::htmlError( int errorCode
   stream >> errorName >> techName >> description >> causes >> solutions;
 
   QString url, protocol, datetime;
-  url = Qt::escape( reqUrl.prettyUrl() );
+
+  // This is somewhat confusing, but we have to escape the externally-
+  // controlled URL twice: once for i18n, and once for HTML.
+  url = Qt::escape( Qt::escape( reqUrl.prettyUrl() ) );
   protocol = reqUrl.protocol();
   datetime = KGlobal::locale()->formatDateTime( QDateTime::currentDateTime(),
                                                 KLocale::LongDate );
